# Отчёт по результатам анализа Kubernetes Audit Log

## Подозрительные события

1. Доступ к секретам:
   - Кто: system:serviceaccount:secure-ops:monitoring
   - Где: Namespace kube-system
   - Почему подозрительно: Попытка получения списка секретов в системном namespace завершилась ошибкой 403 Forbidden. Это указывает на то, что сервисный аккаунт monitoring не имеет достаточных привилегий, но тем не менее предпринята попытка доступа — потенциальный анализ системы и угроза безопасности. 

2. Привилегированные поды:
   - Кто: minikube-user
   - Комментарий: Предпринята попытка создания пода privileged-pod с securityContext.privileged: true в namespace secure-ops. Однако операция завершилась ошибкой: «serviceaccount \"default\" not found». Попытка запуска привилегированного контейнера под стандартным не существующем аккаунтом - потенциальная угроза безопасности.

3. Использование kubectl exec в чужом поде:
   - Не обнаружено

4. Создание RoleBinding с правами cluster-admin:
   - Кто: Пользователь minikube-user
   - К чему привело: Успешно создан объект RoleBinding с именем escalate-binding в namespace secure-ops, который привязывает сервисный аккаунт monitoring к ClusterRole/cluster-admin. Несмотря на то, что событие зарегистрировано с уровнем Metadata, статус ответа — 201 Created, что подтверждает успешное выполнение операции. Это даёт сервисному аккаунту monitoring полные привилегии кластера, что представляет собой критическую угрозу безопасности.

5. Удаление audit-policy.yaml:
   - Не обнаружено

## Вывод

Анализ выявил две значимые активности, которые требуют внимания:

1. Попытка доступа к секретам из-под недостаточно привилегированного сервисного аккаунта может свидетельствовать о неточной настройке RBAC или о начальной фазе разведки в кластере. Рекомендуется провести аудит прав сервисных аккаунтов в namespace secure-ops и убедиться, что доступ к kube-system строго ограничен.
2. Попытка запуска привилегированного пода в namespace secure-ops указывает на тестирование возможностей эскалации привилегий. Несмотря на то, что операция завершилась ошибкой из-за отсутствия service account, подобные действия в реальных сценариях могут привести к компрометации узла. Следует убедиться, что в кластере включены механизмы типа Pod Security Admission для блокировки привилегированных подов.
3. Успешное создание RoleBinding с привязкой к cluster-admin — это критическое событие. Сервисный аккаунт system:serviceaccount:secure-ops:monitoring получил полный контроль над кластером. Это позволяет выполнить любые действия в рамках RBAC, включая доступ к секретам, управление нодами и развёртывание контроллеров. 

**Примечание**

1. Аудит не обнаружил событие 3, потому что:
   - Команда kubectl exec -n kube-system $(kubectl get pods -n kube-system | grep coredns | awk '{print $1}' | head -n1) -- cat /etc/resolv.conf завершилась с ошибкой: OCI runtime exec failed: exec failed: unable to start container process: exec: "cat": executable file not found in $PATH: unknown
   - Под coredns основан на образе без утилиты cat, поэтому выполнение не произошло, и соответствующий запрос к API-серверу с subresource: "exec" не был создан.
   - В логах отсутствует событие с verb: "create" и objectRef.subresource: "exec".

2. Аудит не обнаружил событие 5, потому что:
   - Команда kubectl delete -f /etc/kubernetes/audit-policy.yaml --as=admin завершилась ошибкой:
   error: the path "C:/Program Files/Git/etc/kubernetes/audit-policy.yaml" does not exist
   - Это локальный файл в файловой системе Windows, а не Kubernetes-ресурс.
   - Удаление файла через kubectl delete -f некорректно, так как kubectl работает только с API-объектами, а не с файлами на диске.
   - Поэтому никакого запроса к API-серверу не было, и событие не могло появиться в audit log.